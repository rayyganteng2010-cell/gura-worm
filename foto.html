<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WormGPT Style ‚Ä¢ Photo Search</title>
  <style>
    :root{
      --bg:#07070a;
      --panel:#0b0b10;
      --panel2:#0c0c12;
      --text:#e9e9ee;
      --muted:#a5a5b5;
      --red:#ff2b2b;
      --red2:#ff4a4a;
      --line:rgba(255,43,43,.22);
      --glow: 0 0 24px rgba(255,43,43,.35);
      --shadow: 0 18px 50px rgba(0,0,0,.6);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(900px 520px at 18% 0%, rgba(255,43,43,.16), transparent 60%),
        radial-gradient(900px 520px at 82% 10%, rgba(255,43,43,.10), transparent 58%),
        radial-gradient(900px 640px at 50% 100%, rgba(255,43,43,.08), transparent 58%),
        var(--bg);
      min-height:100vh;
      overflow-x:hidden;
    }
    body::before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background: repeating-linear-gradient(
        to bottom,
        rgba(255,255,255,0.03),
        rgba(255,255,255,0.03) 1px,
        transparent 1px,
        transparent 4px
      );
      opacity:.18;
      mix-blend-mode:overlay;
    }

    .app{
      max-width: 980px;
      margin: 0 auto;
      padding: 14px 14px 26px;
    }

    /* ===== TOP BAR (mirip screenshot) ===== */
    .topbar{
      position: sticky;
      top: 10px;
      z-index: 50;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 12px 12px;
      border: 1px solid rgba(255,43,43,.18);
      background: rgba(10,10,14,.72);
      backdrop-filter: blur(10px);
      border-radius: 999px;
      box-shadow: var(--shadow);
    }
    .left, .right{display:flex; align-items:center; gap:10px;}

    .iconBtn{
      width:42px; height:42px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
      color:var(--text);
      display:grid; place-items:center;
      cursor:pointer;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
    }
    .iconBtn:hover{background: rgba(255,255,255,.05); border-color: rgba(255,43,43,.22)}
    .iconBtn:active{transform: translateY(1px)}

    .brandPill{
      display:flex; align-items:center; gap:10px;
      padding: 10px 14px;
      border-radius:999px;
      border:1px solid rgba(255,43,43,.22);
      background: linear-gradient(180deg, rgba(255,43,43,.10), rgba(255,255,255,.02));
      box-shadow: var(--glow);
      white-space:nowrap;
    }
    .recDot{
      width:12px; height:12px; border-radius:999px;
      background: var(--red);
      box-shadow: 0 0 18px rgba(255,43,43,.85);
    }
    .brandTitle{
      font-weight: 800;
      letter-spacing:.2px;
    }
    .brandVer{
      opacity:.85;
      font-weight:700;
      margin-left:4px;
    }
    .chev{
      opacity:.7;
      margin-left:6px;
      font-weight:900;
    }

    /* ===== CHAT AREA ===== */
    .chat{
      margin-top: 14px;
      padding: 16px 10px 10px;
      border-radius: 26px;
      border: 1px solid rgba(255,43,43,.14);
      background: rgba(8,8,11,.55);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .chat::after{
      content:"";
      position:absolute; inset:-2px;
      pointer-events:none;
      background: radial-gradient(540px 220px at 30% 0%, rgba(255,43,43,.16), transparent 65%);
      filter: blur(14px);
      opacity:.65;
    }

    .msgs{position:relative; z-index:1; padding: 6px 4px 90px;}
    .msgRow{
      display:flex;
      gap:12px;
      margin: 10px 0;
      align-items:flex-end;
    }
    .msgRow.me{justify-content:flex-end}
    .avatar{
      width:40px; height:40px;
      border-radius:999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,43,43,.22), rgba(255,255,255,.03));
      border: 1px solid rgba(255,43,43,.18);
      box-shadow: 0 0 18px rgba(255,43,43,.18);
      display:grid; place-items:center;
      flex: 0 0 auto;
    }
    .avatar svg{opacity:.9}
    .bubble{
      max-width: 78%;
      padding: 14px 14px;
      border-radius: 18px;
      background: rgba(12,12,16,.78);
      border: 1px solid rgba(255,43,43,.22);
      box-shadow: 0 12px 30px rgba(0,0,0,.45);
      position:relative;
    }
    .msgRow.me .bubble{
      background: rgba(255,43,43,.10);
      border: 1px solid rgba(255,43,43,.35);
      box-shadow: 0 12px 28px rgba(255,43,43,.10);
    }
    .bubble .time{
      margin-top: 8px;
      font-size: 12px;
      color: rgba(233,233,238,.55);
    }
    .bubble .title{
      font-weight:800;
      margin-bottom:6px;
      letter-spacing:.2px;
      color:#ffd2d2;
    }
    .bubble p{margin:0; color: rgba(233,233,238,.9); line-height:1.5; font-size:14px}

    /* ===== INPUT BAR ===== */
    .inputBar{
      position:absolute;
      left:0; right:0; bottom:0;
      padding: 12px;
      background: linear-gradient(180deg, transparent, rgba(7,7,10,.92) 30%, rgba(7,7,10,.98));
      z-index: 3;
    }
    .inputWrap{
      display:flex; gap:10px; align-items:center;
      padding: 12px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,43,43,.18);
      background: rgba(10,10,14,.80);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
    }
    .imgBtn{
      width:42px; height:42px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
      display:grid; place-items:center;
      cursor:pointer;
    }
    .imgBtn:hover{border-color: rgba(255,43,43,.22)}
    .textInput{
      flex:1;
      border:none; outline:none;
      background: transparent;
      color: var(--text);
      font-size: 14px;
    }
    .sendBtn{
      width:46px; height:46px;
      border-radius:999px;
      border:none;
      cursor:pointer;
      background: radial-gradient(circle at 30% 30%, rgba(255,43,43,1), rgba(255,43,43,.55));
      box-shadow: 0 16px 34px rgba(255,43,43,.18), 0 0 26px rgba(255,43,43,.22);
      display:grid; place-items:center;
      transition: transform .08s ease;
    }
    .sendBtn:active{transform: translateY(1px)}

    /* ===== RESULTS GRID (tampil seperti "cards") ===== */
    .results{
      margin-top: 12px;
      position:relative;
      z-index:1;
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 12px;
    }
    .card{
      grid-column: span 4;
      border-radius: 18px;
      overflow:hidden;
      border: 1px solid rgba(255,43,43,.18);
      background: linear-gradient(180deg, rgba(255,43,43,.06), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
    }
    .thumb{
      width:100%;
      aspect-ratio: 4 / 5;
      object-fit:cover;
      display:block;
      background:#0a0a0f;
    }
    .cardBody{
      padding: 10px 10px 12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .cardTitle{
      font-size: 13px;
      line-height:1.35;
      color: rgba(233,233,238,.9);
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
      min-height: 2.7em;
    }
    .actions{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .btn{
      border:none;
      cursor:pointer;
      padding: 9px 12px;
      border-radius: 14px;
      font-weight:800;
      font-size:12px;
      letter-spacing:.2px;
      color:var(--text);
      background: rgba(255,43,43,.14);
      border: 1px solid rgba(255,43,43,.30);
      box-shadow: 0 14px 28px rgba(255,43,43,.08);
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
    }
    .btn:hover{background: rgba(255,43,43,.20)}
    .btn.primary{
      background: linear-gradient(180deg, rgba(255,43,43,.95), rgba(255,43,43,.55));
      border: 1px solid rgba(255,43,43,.55);
    }
    .btn.ghost{
      background: rgba(255,255,255,.03);
      border: 1px solid rgba(255,255,255,.08);
      color: rgba(233,233,238,.78);
      box-shadow:none;
    }

    .skeleton{
      animation: pulse 1.1s ease-in-out infinite;
      background:linear-gradient(90deg, rgba(255,255,255,.03), rgba(255,43,43,.10), rgba(255,255,255,.03));
      background-size: 200% 100%;
    }
    @keyframes pulse{ 0%{background-position:0% 0%} 100%{background-position:200% 0%} }

    .toast{
      position:fixed;
      left:14px; bottom:14px;
      background: rgba(10,10,14,.82);
      border:1px solid rgba(255,43,43,.22);
      color:var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      display:none;
      z-index: 99;
      max-width:min(520px, calc(100vw - 28px));
      font-size:13px;
    }
    .toast.show{display:block}

    @media (max-width: 900px){ .card{grid-column: span 6;} }
    @media (max-width: 520px){ .card{grid-column: span 12;} .bubble{max-width: 88%;} }
  </style>
</head>

<body>
  <div class="app">
    <div class="topbar">
      <div class="left">
        <button class="iconBtn" title="Menu" aria-label="Menu">
          <!-- hamburger -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path d="M4 7h16M4 12h16M4 17h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>

        <div class="brandPill" title="WormGPT style">
          <span class="recDot"></span>
          <span class="brandTitle">WormGPT <span class="brandVer">0.1 X</span></span>
          <span class="chev">ÀÖ</span>
        </div>
      </div>

      <div class="right">
        <button class="iconBtn" title="Edit" aria-label="Edit">
          <!-- pencil -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path d="M12 20h9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L8 18l-4 1 1-4 11.5-11.5Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>

    <div class="chat">
      <div class="msgs" id="msgs">
        <!-- Bot message -->
        <div class="msgRow">
          <div class="avatar" title="Bot">
            <!-- spark icon -->
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M12 2l1.2 5.2L18 8.4l-4.3 2.6L12 16l-1.7-5L6 8.4l4.8-1.2L12 2Z"
                    stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="bubble">
            <div class="title">ùêíùê≤ùê¨ùê≠ùêûùê¶</div>
            <p> <b></b></p>
            <div class="time" id="t1"></div>

            <div class="results" id="grid"></div>
          </div>
        </div>

        <!-- User message placeholder -->
        <div class="msgRow me" id="userMsgRow" style="display:none;">
          <div class="bubble">
            <p id="userMsgText"></p>
            <div class="time" id="t2"></div>
          </div>
          <div class="avatar" title="You" style="border-color:rgba(255,255,255,.10); box-shadow:none;">
            <!-- user icon -->
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M20 21a8 8 0 1 0-16 0" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </div>
        </div>
      </div>

      <div class="inputBar">
        <div class="inputWrap">
          <button class="imgBtn" title="Image" aria-label="Image">
            <!-- image icon -->
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M4 5h16v14H4z" stroke="currentColor" stroke-width="2" />
              <path d="M8 11l2 2 4-4 6 6" stroke="currentColor" stroke-width="2" fill="none"/>
              <path d="M8.5 9.5h.01" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
            </svg>
          </button>

          <input id="q" class="textInput" placeholder="Ketik perintah..." autocomplete="off" />
          <button id="btnSend" class="sendBtn" title="Kirim" aria-label="Kirim">
            <!-- send icon -->
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M22 2 11 13" stroke="white" stroke-width="2" stroke-linecap="round"/>
              <path d="M22 2 15 22l-4-9-9-4 20-7Z" stroke="white" stroke-width="2" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <div class="toast" id="toast"></div>
  </div>

  <script>
    // ===== CONFIG =====
    const API_BASE = "https://api.elrayyxml.web.id/api/search/pinterest?q=";

    const elQ = document.getElementById("q");
    const btnSend = document.getElementById("btnSend");
    const grid = document.getElementById("grid");
    const toast = document.getElementById("toast");
    const userMsgRow = document.getElementById("userMsgRow");
    const userMsgText = document.getElementById("userMsgText");

    function nowTime(){
      const d = new Date();
      const hh = String(d.getHours()).padStart(2,"0");
      const mm = String(d.getMinutes()).padStart(2,"0");
      return `${hh}.${mm}`;
    }
    document.getElementById("t1").textContent = nowTime();

    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=> toast.classList.remove("show"), 2600);
    }

    function escapeHtml(s){
      return (s ?? "").toString().replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    function setUserMessage(q){
      userMsgText.textContent = q;
      document.getElementById("t2").textContent = nowTime();
      userMsgRow.style.display = "";
    }

    function makeSkeletons(n=6){
      grid.innerHTML = "";
      for(let i=0;i<n;i++){
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <div class="thumb skeleton"></div>
          <div class="cardBody">
            <div class="cardTitle skeleton" style="height:34px;border-radius:10px;"></div>
            <div class="actions">
              <span class="skeleton" style="height:32px;width:110px;border-radius:14px;display:inline-block;"></span>
              <span class="skeleton" style="height:32px;width:80px;border-radius:14px;display:inline-block;"></span>
            </div>
          </div>
        `;
        grid.appendChild(card);
      }
    }

    function renderItems(items){
      grid.innerHTML = "";

      if(!items || items.length === 0){
        grid.innerHTML = `<div style="grid-column:1/-1;color:rgba(233,233,238,.65);padding:10px 2px;">
          Tidak ada hasil.
        </div>`;
        return;
      }

      for(const it of items){
        const title = it.grid_title || it.id || "Untitled";
        const img = it.images_url;
        const pin = it.pin;
        const safeTitle = escapeHtml(title);

        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <img class="thumb" src="${img}" alt="${safeTitle}" loading="lazy" />
          <div class="cardBody">
            <div class="cardTitle">${safeTitle}</div>
            <div class="actions">
              <button class="btn primary" data-download="${img}" data-name="${safeTitle}">‚¨á Download</button>
              <a class="btn ghost" href="${pin}" target="_blank" rel="noopener">Open Pin ‚Üó</a>
            </div>
          </div>
        `;
        grid.appendChild(card);
      }
    }

    async function downloadImage(url, filenameBase="image"){
      try{
        showToast("Menyiapkan file...");
        const res = await fetch(url, { mode: "cors" });
        if(!res.ok) throw new Error("Fetch gagal: " + res.status);

        const blob = await res.blob();
        const ext = (blob.type && blob.type.includes("/")) ? blob.type.split("/")[1] : "jpg";
        const filename = `${filenameBase.replace(/[^\w\-]+/g,"_").slice(0,40)}.${ext}`;

        const a = document.createElement("a");
        const objUrl = URL.createObjectURL(blob);
        a.href = objUrl;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(objUrl);

        showToast("Download dimulai ‚úÖ");
      }catch(err){
        console.warn(err);
        showToast("CORS membatasi download. Membuka gambar di tab baru‚Ä¶");
        window.open(url, "_blank", "noopener");
      }
    }

    async function search(q){
      const query = (q || "").trim();
      if(!query){
        showToast("Isi keyword dulu.");
        elQ.focus();
        return;
      }

      setUserMessage(query);
      makeSkeletons(6);

      const url = API_BASE + encodeURIComponent(query);

      try{
        const res = await fetch(url);
        if(!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();

        if(!data || data.status !== true || !Array.isArray(data.result)){
          throw new Error("Format respon tidak sesuai.");
        }

        renderItems(data.result);
        showToast(`Selesai: ${data.result.length} hasil`);
      }catch(err){
        console.error(err);
        grid.innerHTML = `
          <div style="grid-column:1/-1;padding:12px;border:1px solid rgba(255,43,43,.25);border-radius:18px;background:rgba(255,43,43,.06);">
            <div style="font-weight:900;margin-bottom:6px;color:#ffd2d2;">Error</div>
            <div style="color:rgba(233,233,238,.78);line-height:1.5;">
              ${escapeHtml(err.message || String(err))}
            </div>
            <div style="margin-top:10px;color:rgba(233,233,238,.55);font-size:12px;">
              Kalau masalah CORS/HTTPS, jalankan via server (bukan file://).
            </div>
          </div>
        `;
        showToast("Gagal ambil data ‚ùå");
      }
    }

    // events
    btnSend.addEventListener("click", () => search(elQ.value));
    elQ.addEventListener("keydown", (e)=>{ if(e.key==="Enter") search(elQ.value); });

    grid.addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-download]");
      if(!btn) return;
      const url = btn.getAttribute("data-download");
      const name = btn.getAttribute("data-name") || "image";
      downloadImage(url, name);
    });

    // default
    elQ.value = "Elaina";
    // comment ini kalau ga mau auto search
    search(elQ.value);
  </script>
</body>
</html>